---
title: Query builder & HogQL
---

The Query builder in PostHog is an advanced feature which allows for more complex or ad-hoc queries than would be normally possible with our basic insights.
It is meant to give advanced users the ability to query their data more directly.
The query builder is powered by `HogQL` which is our own SQL-like dialect for writing custom expressions and aggregations.

> This feature is currently in beta and is still under active development - the features shown here may change at any point

## What is HogQL?

### Structure of a HogQL query

### Basic expressions

```hogql
concat(properties.$browser, ' ', properties.$geoip_city_name)
```

#### Adding new columns to 'Live events'

### Accessing properties

### Aggregations

| Operator        | Example                                   | Notes                                                                             |
| --------------- | ----------------------------------------- | --------------------------------------------------------------------------------- |
| `count`         | `count()`                                 | Counts the total number of events                                                 |
| `countDistinct` | `countDistinct(properties.$browser)`      | Counts number of distinct values for a given property                             |
| `avg`           | `avg(toInt(properties.$browser_version))` | Calculates the average value of a numerical property                              |
| `sum`           | `sum(toInt(properties.ride_distance))`    | Calculates the sum of a numerical property                                        |
| `min`           | `min(toInt(properties.$browser_version))` | Calculates the minimum value of a numerical property                              |
| `max`           | `max(toInt(properties.$browser_version))` | Calculates the maximum value of a numerical property                              |
| `any`           | `any(properties.distinct_id)`             | Returns the first non-NULL value for a property, which may be different each time |

> **Note**: Arguments to `avg`, `sum`, `min`, and `max` must first be cast to ints using the `toInt` function

> **Note**: We currently do not support using event timestamps in aggregations

#### `-If` with aggregations

All aggregations have a correspoding `-If` version, which allows you to filter out specific events from within the aggregation based on a statement.
For this version of the aggregation, the first argument is the value you would like to aggregate, withe the second value being a true or false expression.
If this expression evaluates to false, this particular event won't be included in the aggregation.

**Examples**

-   `avgIf(toInt(properties.$browser_version), properties.$browser == 'Chrome')` - Average Chrome version
-   `countIf(properties.$browser == 'Chrome')` - Number of events sent from Chrome
-   `countDistinctIf(properties.$browser_version, properties.$browser == 'Chrome')` - Number of unique Chrome versions

### Aliasing fields

## Example queries

## Full HogQL reference

Below is a list of all the currently supported functions in HogQL expressions, along with the equivalent function within ClickHouse.

For deeper reference on the specific behaviors of each of these functions, take a look at the [full SQL reference](https://clickhouse.com/docs/en/sql-reference/functions/) for ClickHouse.

The full, up-to-date list of supported functions can also be found [here](https://github.com/PostHog/posthog/blob/master/posthog/hogql/hogql.py#L13).

### Arithmetic

| Operator | ClickHouse equivalent |
| -------- | --------------------- |
| `abs`    | `abs`                 |
| `max2`   | `max2`                |
| `min2`   | `min2`                |

### Type conversion

| Operator            | ClickHouse equivalent     |
| ------------------- | ------------------------- |
| `toInt`             | `toInt64OrNull`           |
| `toFloat`           | `toFloat64OrNull`         |
| `toDecimal`         | `toDecimal64OrNull`       |
| `toDate`            | `toDateOrNull`            |
| `toDateTime`        | `parseDateTimeBestEffort` |
| `toIntervalSecond`  | `toIntervalSecond`        |
| `toIntervalMinute`  | `toIntervalMinute`        |
| `toIntervalHour`    | `toIntervalHour`          |
| `toIntervalDay`     | `toIntervalDay`           |
| `toIntervalWeek`    | `toIntervalWeek`          |
| `toIntervalMonth`   | `toIntervalMonth`         |
| `toIntervalQuarter` | `toIntervalQuarter`       |
| `toIntervalYear`    | `toIntervalYear`          |
| `toString`          | `toString`                |

### Date functions

| Operator                  | ClickHouse equivalent     |
| ------------------------- | ------------------------- |
| `now`                     | `now`                     |
| `toMonday`                | `toMonday`                |
| `toStartOfYear`           | `toStartOfYear`           |
| `toStartOfQuarter`        | `toStartOfQuarter`        |
| `toStartOfMonth`          | `toStartOfMonth`          |
| `toStartOfWeek`           | `toStartOfWeek`           |
| `toStartOfDay`            | `toStartOfDay`            |
| `toStartOfHour`           | `toStartOfHour`           |
| `toStartOfMinute`         | `toStartOfMinute`         |
| `toStartOfSecond`         | `toStartOfSecond`         |
| `toStartOfFiveMinutes`    | `toStartOfFiveMinutes`    |
| `toStartOfTenMinutes`     | `toStartOfTenMinutes`     |
| `toStartOfFifteenMinutes` | `toStartOfFifteenMinutes` |
| `toTimezone`              | `toTimezone`              |
| `age`                     | `age`                     |
| `dateDiff`                | `dateDiff`                |
| `dateTrunc`               | `dateTrunc`               |
| `formatDateTime`          | `formatDateTime`          |

### String functions

| Operator                     | ClickHouse equivalent        |
| ---------------------------- | ---------------------------- |
| `length`                     | `lengthUTF8`                 |
| `empty`                      | `empty`                      |
| `notEmpty`                   | `notEmpty`                   |
| `leftPad`                    | `leftPad`                    |
| `rightPad`                   | `rightPad`                   |
| `lower`                      | `lower`                      |
| `upper`                      | `upper`                      |
| `repeat`                     | `repeat`                     |
| `format`                     | `format`                     |
| `concat`                     | `concat`                     |
| `coalesce`                   | `coalesce`                   |
| `substring`                  | `substringUTF8`              |
| `appendTrailingCharIfAbsent` | `appendTrailingCharIfAbsent` |
| `endsWith`                   | `endsWith`                   |
| `startsWith`                 | `startsWith`                 |
| `trim`                       | `trimBoth`                   |
| `trimLeft`                   | `trimLeft`                   |
| `trimRight`                  | `trimRight`                  |
| `extractTextFromHTML`        | `extractTextFromHTML`        |
| `like`                       | `like`                       |
| `ilike`                      | `ilike`                      |
| `notLike`                    | `notLike`                    |
| `replace`                    | `replace`                    |
| `replaceOne`                 | `replaceOne`                 |

### Array functions

| Operator | ClickHouse equivalent |
| -------- | --------------------- |
| `tuple`  | `tuple`               |

### Conditional statetmens

| Operator  | ClickHouse equivalent |
| --------- | --------------------- |
| `ifElse`  | `if`                  |
| `multiIf` | `multiIf`             |

### Rounding functions

| Operator | ClickHouse equivalent |
| -------- | --------------------- |
| `round`  | `round`               |
| `floor`  | `floor`               |
| `ceil`   | `ceil`                |
| `trunc`  | `trunc`               |
